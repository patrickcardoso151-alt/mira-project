<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.I.R.A. v10.0</title>
    <style>
        :root { --mira-green: #00ff41; --mira-bg: #000b00; }
        html, body { height: 100%; margin: 0; background: var(--mira-bg); color: var(--mira-green); font-family: 'Courier New', monospace; overflow: hidden; }
        #terminal { display: flex; flex-direction: column; height: 100dvh; padding: 15px; box-sizing: border-box; }
        #hud { display: flex; justify-content: space-between; font-size: 0.7rem; margin-bottom: 10px; }
        #avatar-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100px; }
        #mira-orb { width: 50px; height: 50px; border-radius: 50%; background: var(--mira-green); box-shadow: 0 0 15px var(--mira-green); margin-bottom: 10px; }
        #log { flex-grow: 1; overflow-y: auto; font-size: 0.85rem; border-top: 1px solid #003300; padding: 10px 0; }
        .input-area { display: flex; border-top: 2px solid var(--mira-green); padding: 10px 0; }
        input { background: transparent; border: none; color: var(--mira-green); outline: none; flex-grow: 1; font-size: 1rem; }
        button { background: #003300; color: var(--mira-green); border: 1px solid var(--mira-green); font-size: 0.6rem; padding: 5px; cursor: pointer; }
        #overlay { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; align-items: center; justify-content: center; text-align: center; cursor: pointer; }
    </style>
</head>
<body>

<div id="overlay" onclick="iniciarMIRA()">[ CLIQUE PARA CONECTAR ]</div>

<div id="terminal">
    <div id="hud">
        <span>OP: PATRICK</span>
        <button onclick="resetarChave()">RESETAR CHAVE</button>
    </div>

    <div id="avatar-container">
        <div id="mira-orb"></div>
        <div id="status-neural">NEURAL: AGUARDANDO</div>
    </div>

    <div id="log"></div>

    <div class="input-area">
        <span style="margin-right:8px;">CMD></span>
        <input type="text" id="inputComando" placeholder="Digite aqui..." autocomplete="off">
    </div>
</div>

<script>
    function addLog(o, t) {
        const log = document.getElementById('log');
        log.innerHTML += `<div><b>[${o}]</b> ${t}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function resetarChave() {
        localStorage.removeItem('gemini_key');
        alert("Chave removida. Recarregue a página para digitar a nova.");
        location.reload();
    }

    async function pensarComGemini(pergunta) {
        let apiKey = localStorage.getItem('gemini_key');
        
        if (!apiKey) {
            apiKey = prompt("M.I.R.A. - Digite ou cole sua API Key:");
            if (apiKey) {
                apiKey = apiKey.trim();
                localStorage.setItem('gemini_key', apiKey);
            } else return;
        }

        addLog("M.I.R.A.", "Consultando matriz...");
        
        // URL simplificada (v1) para evitar erros de versão
        const url = `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: pergunta }] }]
                })
            });

            const data = await response.json();

            if (data.error) {
                addLog("ERRO", data.error.message);
                if(data.error.message.includes("API key")) {
                    localStorage.removeItem('gemini_key');
                    addLog("SISTEMA", "Chave inválida removida. Tente novamente.");
                }
            } else {
                const respostaIA = data.candidates[0].content.parts[0].text;
                addLog("M.I.R.A.", respostaIA);
                // Voz opcional
                const m = new SpeechSynthesisUtterance(respostaIA);
                m.lang = 'pt-BR';
                window.speechSynthesis.speak(m);
            }
        } catch (erro) {
            addLog("ERRO", "Falha de rede ou chave expirada.");
        }
    }

    async function processar(val) {
        if(!val.trim()) return;
        addLog("PATRICK", val);
        document.getElementById('inputComando').value = "";
        await pensarComGemini(val);
    }

    function iniciarMIRA() {
        document.getElementById('overlay').style.display = 'none';
        addLog("SISTEMA", "M.I.R.A. v10.0 ONLINE.");
    }

    document.getElementById('inputComando').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') processar(e.target.value);
    });
</script>
</body>
</html>
