<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.I.R.A. v10.0 - Neural Core</title>
    <style>
        :root { --mira-green: #00ff41; --mira-bg: #000b00; }
        html, body { height: 100%; margin: 0; padding: 0; background: var(--mira-bg); color: var(--mira-green); font-family: 'Courier New', monospace; overflow: hidden; }
        #terminal { display: flex; flex-direction: column; height: 100dvh; padding: 15px; box-sizing: border-box; border: 2px solid var(--mira-green); }
        #hud { display: flex; justify-content: space-between; font-size: 0.65rem; margin-bottom: 5px; opacity: 0.8; }
        #avatar-container { display: flex; justify-content: center; align-items: center; min-height: 80px; }
        #mira-orb { width: 60px; height: 60px; border-radius: 50%; background: radial-gradient(circle, var(--mira-green) 0%, transparent 70%); box-shadow: 0 0 20px var(--mira-green); transition: all 0.5s; }
        #log { flex-grow: 1; overflow-y: auto; font-size: 0.85rem; padding: 10px 0; border-top: 1px solid #003300; }
        .input-area { display: flex; align-items: center; border-top: 2px solid var(--mira-green); padding: 15px 0; background: var(--mira-bg); margin-bottom: 5px; }
        input { background: transparent; border: none; color: var(--mira-green); outline: none; flex-grow: 1; font-size: 1.1rem; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px; cursor: pointer; }
        .forma-circulo { clip-path: circle(50%); }
        .forma-hex { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); }
    </style>
</head>
<body>

<div id="overlay" onclick="iniciarMIRA()">[ CLIQUE PARA CONECTAR À MATRIZ M.I.R.A. ]</div>

<div id="terminal">
    <div id="hud"><span>OP: PATRICK</span><span id="sync-status">NEURAL: ONLINE</span></div>
    <div id="avatar-container"><div id="mira-orb" class="forma-circulo"></div></div>
    <div id="log"></div>
    <div class="input-area">
        <span style="color:var(--mira-green); font-weight:bold; margin-right:8px;">CMD></span>
        <input type="text" id="inputComando" placeholder="Escreva aqui..." autocomplete="off">
    </div>
</div>

<script>
    function addLog(o, t) {
        const log = document.getElementById('log');
        log.innerHTML += `<div><b>[${o}]</b> ${t}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function falar(t) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'pt-BR';
        window.speechSynthesis.speak(m);
    }

    async function pensarComGemini(pergunta) {
        let apiKey = localStorage.getItem('gemini_key');
        if (!apiKey) {
            apiKey = prompt("Insira sua API Key:");
            if (apiKey) { localStorage.setItem('gemini_key', apiKey.trim()); } else return;
        }

        document.getElementById('mira-orb').className = "forma-hex";
        addLog("M.I.R.A.", "Consultando matriz...");

        // Lista de modelos para tentar em ordem de compatibilidade
        const modelos = [
            "gemini-1.5-flash",
            "gemini-pro"
        ];

        for (let modelo of modelos) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelo}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: pergunta }] }] })
                });

                const data = await response.json();
                if (data.candidates && data.candidates[0].content) {
                    const respostaIA = data.candidates[0].content.parts[0].text;
                    addLog("M.I.R.A.", respostaIA);
                    falar(respostaIA);
                    document.getElementById('mira-orb').className = "forma-circulo";
                    return; // Sucesso!
                }
            } catch (e) { console.log("Tentando próximo modelo..."); }
        }
        
        addLog("ERRO", "Não foi possível conectar aos modelos. Verifique sua chave.");
        document.getElementById('mira-orb').className = "forma-circulo";
    }

    async function processar(val) {
        if(!val.trim()) return;
        addLog("PATRICK", val);
        document.getElementById('inputComando').value = "";
        await pensarComGemini(val);
    }

    function iniciarMIRA() {
        document.getElementById('overlay').style.display = 'none';
        addLog("SISTEMA", "M.I.R.A. v10.0 ONLINE.");
        falar("Sistema pronto.");
    }

    document.getElementById('inputComando').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') processar(e.target.value);
    });
</script>
</body>
</html>
