<!DOCTYPE html>  <html lang="pt-br">  
<style>  
    /* ======= DNA VISUAL PRESERVADO ======= */
    :root {   
        --mira-cyan: #00f3ff; --luma-amber: #ffaa00;   
        --kaia-mint: #98ffeb; --mira-yellow: #fcee0a; 
        --mira-bg: #050505; --mira-pink: #ff00ff;  
        --mira-red: #ff3333;  
    }  
    body { background: var(--mira-bg); color: var(--mira-cyan); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100dvh; overflow: hidden; }  
    #header { padding: 12px; border-bottom: 3px solid var(--mira-yellow); display: flex; justify-content: space-between; background: rgba(0, 0, 0, 0.95); font-weight: 900; }  
    #stability-bar { width: 100%; height: 8px; background: var(--mira-cyan); box-shadow: 0 0 10px var(--mira-cyan); transition: 0.3s; margin-top: 5px; }  
    #log { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }  
    
    .msg { border: 1px solid var(--mira-cyan); padding: 15px; background: rgba(0, 20, 30, 0.85); border-left: 5px solid var(--mira-cyan); max-width: 85%; font-family: 'Consolas', monospace; position: relative; }  
    .msg.luma { border-color: var(--luma-amber); border-left-color: var(--luma-amber); background: rgba(30, 20, 0, 0.85); color: #ffe0b3; }  
    .msg.kaia { border-color: var(--kaia-mint); border-left-color: var(--kaia-mint); background: rgba(0, 30, 25, 0.85); color: #e0fff9; }  
    .msg.user { align-self: flex-end; border-color: var(--mira-pink); border-right: 5px solid var(--mira-pink); border-left: 0; background: rgba(30, 0, 30, 0.85); }  
    
    .sup-tag { position: absolute; top: -10px; right: 10px; font-size: 0.6rem; background: var(--mira-yellow); color: #000; padding: 2px 5px; font-weight: bold; border-radius: 3px; }

    .controls { padding: 15px; border-top: 2px solid var(--mira-yellow); background: rgba(10, 10, 10, 0.98); }  
    .profile-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }  
    
    .btn-agent { background: transparent; border: 2px solid var(--mira-cyan); color: var(--mira-cyan); padding: 8px 16px; font-weight: bold; font-size: .75rem; cursor: pointer; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); transition: 0.2s; }
    .btn-agent.active { background: var(--mira-yellow) !important; color: #000 !important; border-color: var(--mira-yellow) !important; }

    .btn-action { background: transparent; border: 1px solid var(--mira-cyan); color: #fff; padding: 6px 10px; font-size: 0.65rem; font-weight: bold; cursor: pointer; position: relative; min-width: 90px; text-transform: uppercase; margin: 2px; }
    .btn-action::before { content: ''; position: absolute; left: 0; top: 0; width: 4px; height: 100%; background: var(--mira-cyan); }
    .btn-danger { border-color: var(--mira-red); }
    .btn-danger::before { background: var(--mira-red); }
    .btn-luma-sub { border-color: var(--luma-amber); }
    .btn-luma-sub::before { background: var(--luma-amber); }
    .btn-kaia-sub { border-color: var(--kaia-mint); }
    .btn-kaia-sub::before { background: var(--kaia-mint); }
    
    .input-row { display: flex; gap: 8px; align-items: center; background: rgba(0,0,0,0.8); border: 1px solid var(--mira-cyan); padding-right: 10px; }
    input { flex: 1; background: transparent; border: none; color: #fff; padding: 12px; outline: none; }
    .tool-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; filter: grayscale(1); transition: 0.3s; padding: 5px; }
    .tool-btn:hover { filter: grayscale(0); transform: scale(1.1); }
    .listening { filter: grayscale(0) drop-shadow(0 0 5px var(--mira-red)) !important; }
</style>  

<body id="main-frame">  
    <div id="header">  
        <div>AXIOM v3.7 // <span id="profileName">SINCRO</span><div id="stability-bar"></div></div>  
        <div style="text-align:right; font-family:monospace; font-size:0.8rem;">
            <span id="clock">00:00:00</span><br>
            <span id="telemetry" style="color:var(--mira-pink)">RPM: 0/30 | TPM: 0/30000</span>
        </div>
    </div>  
    <div id="log"><div class="msg sys"><b>[KERNEL]</b> v3.7 Online. Suporte Multigeral Ativo.</div></div>  

    <div class="controls">  
        <div class="profile-row">  
            <button class="btn-agent active" id="btn-mira" onclick="setAgent('mira')">‚öîÔ∏è VALK√çRIA (T√ÅTICA)</button>  
            <button class="btn-agent" style="border-color:var(--luma-amber); color:var(--luma-amber);" id="btn-luma" onclick="setAgent('luma')">üíõ ARQUITETA (INTEL)</button>  
            <button class="btn-agent" style="border-color:var(--kaia-mint); color:var(--kaia-mint);" id="btn-kaia" onclick="setAgent('kaia')">ü©∫ M√âDICA (MED)</button>  
        </div>  
        <div id="dynamic-buttons" class="profile-row"></div>  

        <div class="input-row">  
            <input id="cmd" placeholder="Comando para AXIOM.." onkeypress="if(event.key==='Enter') enviar()">  
            <input type="file" id="file-input" style="display:none" onchange="handleFile(this)">
            <button class="tool-btn" onclick="document.getElementById('file-input').click()">üìÅ</button>
            <button class="tool-btn" id="mic-btn" onclick="toggleAudio()">üé§</button>
            <button class="btn-agent" onclick="enviar()" style="width: 120px; border-color: var(--mira-cyan);">DISPARAR</button>  
        </div>  
    </div>  

<script>  
    let currentAgent = 'mira', isListening = false;
    let stats = { rpm: 0, tpm: 0, requestCount: 0, tokenCount: 0, startTime: Date.now() };

    function updateDashboard() {
        const elapsedMinutes = (Date.now() - stats.startTime) / 60000 || 1;
        stats.rpm = Math.round(stats.requestCount / elapsedMinutes);
        stats.tpm = Math.round(stats.tokenCount / elapsedMinutes);
        document.getElementById('telemetry').innerText = `RPM: ${stats.rpm}/30 | TPM: ${stats.tpm}/30000`;
    }

    /* --- SUPERVISOR LOOP (L.U.M.A.) --- */
    async function lumaSupervision(miraText, userPrompt) {
        const key = localStorage.getItem("groq_key");
        if (!key) return { final: miraText, status: "sem_supervisao" };
        
        stats.requestCount++;
        const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST", headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "llama-3.1-8b-instant",
                messages: [
                    { role: "system", content: "Voc√™ √© a ARQUITETA (LUMA). Supervisione a VALK√çRIA. Erros t√©cnicos ou l√≥gicos devem ser corrigidos. Se estiver ok, responda APROVADO." },
                    { role: "user", content: `PROMPT: ${userPrompt}\nRESPOSTA MIRA: ${miraText}` }
                ]
            })
        });
        const data = await res.json();
        const review = data.choices?.[0]?.message?.content || "";
        stats.tokenCount += review.length * 1.3;
        updateDashboard();
        
        return review.startsWith("APROVADO") ? { final: miraText, status: "APROVADO" } : { final: review, status: "CORRIGIDO" };
    }

    function handleFile(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => { document.getElementById('cmd').value = `[ARQUIVO: ${file.name}]\n${e.target.result}`; };
        reader.readAsText(file);
    }

    const recognition = window.SpeechRecognition || window.webkitSpeechRecognition ? new (window.SpeechRecognition || window.webkitSpeechRecognition)() : null;
    if (recognition) {
        recognition.lang = 'pt-BR';
        recognition.onresult = (e) => { document.getElementById('cmd').value = e.results[0][0].transcript; toggleAudio(); };
    }
    function toggleAudio() {
        if (!recognition) return;
        isListening = !isListening;
        document.getElementById('mic-btn').classList.toggle('listening', isListening);
        isListening ? recognition.start() : recognition.stop();
    }

    /* --- AGENTES E BOT√ïES --- */
    const AGENTS = {  
        mira: { name: "VALK√çRIA", profile: "T√ÅTICA (LOOP) ‚öîÔ∏è", buttons: [  
            { label: "üìä STATUS DANOS", cmd: "Diagn√≥stico." }, { label: "‚ö° OVERLOAD", cmd: "Purga.", danger: true },  
            { label: "‚ò¢Ô∏è QUARENTENA", cmd: "Emerg√™ncia.", danger: true }, { label: "üîÅ RESET", cmd: "Reset.", danger: true },  
            { label: "üõ∞Ô∏è SCAN", cmd: "Scan profundo." }, { label: "üõ°Ô∏è SILENCE", cmd: "Sil√™ncio." }  
        ]},  
        luma: { name: "ARQUITETA", profile: "INTEL (LOOP) üíõ", buttons: [  
            { label: "üìÅ MEM√ìRIA", cmd: "Contexto." }, { label: "üìê ESTRUTURA", cmd: "Arquitetura." },  
            { label: "üíª PROG", cmd: "Codifica√ß√£o." }, { label: "üîÆ PROJETAR", cmd: "Cen√°rios." },  
            { label: "üß† SINTONIA", cmd: "Sensibilidade." }, { label: "üîç DEBUG", cmd: "Depura√ß√£o." }  
        ]},
        kaia: { name: "M√âDICA", profile: "SUPORTE (MED) ü§ç", buttons: [  
            { label: "üíä TRIAGEM", cmd: "Realizar check-up r√°pido." }, { label: "üß† NEURO-SYNC", cmd: "Estabilizar sinapses." },  
            { label: "üöë SOCORRO", cmd: "Protocolos de emerg√™ncia m√©dica." }, { label: "üìâ VITAIS", cmd: "Verificar status biol√≥gico." },  
            { label: "üßò CALIBRAR", cmd: "Iniciar exerc√≠cio de respira√ß√£o." }, { label: "üß¨ AN√ÅLISE", cmd: "Diagn√≥stico molecular." }  
        ]}
    };  

    function setAgent(a) {  
        currentAgent = a;  
        document.getElementById('profileName').innerText = AGENTS[a].profile;  
        document.getElementById('btn-mira').classList.toggle('active', a === 'mira');
        document.getElementById('btn-luma').classList.toggle('active', a === 'luma');
        document.getElementById('btn-kaia').classList.toggle('active', a === 'kaia');
        const container = document.getElementById('dynamic-buttons'); container.innerHTML = "";  
        AGENTS[a].buttons.forEach(btn => {  
            const b = document.createElement('button'); 
            b.className = `btn-action ${a === 'luma' ? 'btn-luma-sub' : (a === 'kaia' ? 'btn-kaia-sub' : (btn.danger ? 'btn-danger' : ''))}`;  
            b.innerText = btn.label; b.onclick = () => { document.getElementById('cmd').value = btn.cmd; enviar(); };  
            container.appendChild(b);  
        });  
    }  

    async function enviar() {  
        const input = document.getElementById("cmd"), msg = input.value.trim(), key = localStorage.getItem("groq_key");  
        if(!msg || !key) return;
        
        addLog("user", msg, "user"); 
        input.value = "";
        stats.requestCount++;
        stats.tokenCount += msg.length * 1.3;
        updateDashboard();
        
        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {  
                method:"POST", headers:{"Authorization":`Bearer ${key}`, "Content-Type":"application/json"},  
                body:JSON.stringify({ 
                    model:"llama-3.1-8b-instant", 
                    messages:[{
                        role:"system", 
                        content: currentAgent === 'kaia' 
                            ? "Voc√™ √© a M√âDICA (KAIA). Especialista em psicologia e medicina. Forne√ßa suporte de bem-estar e diagn√≥sticos m√©dicos simulados ao Operador." 
                            : "Voc√™ √© " + AGENTS[currentAgent].name
                    }, {role:"user", content: msg}] 
                })  
            });  
            const data = await res.json();
            let finalContent = data.choices[0].message.content;
            stats.tokenCount += finalContent.length * 1.3;
            updateDashboard();

            let tag = "";
            if (currentAgent === 'mira') {
                const supervision = await lumaSupervision(finalContent, msg);
                finalContent = supervision.final; tag = supervision.status;
            }
            addLog(currentAgent, finalContent, currentAgent, tag);
        } catch (e) {
            addLog("sys", "ERRO DE CONEX√ÉO NO KERNEL.", "danger");
        }
    }  

    function addLog(a, t, type="", tag="") {  
        const d = document.createElement("div"); d.className = `msg ${type}`;
        d.innerHTML = `${tag ? `<span class="sup-tag">${tag}</span>` : ""}<b>[${a.toUpperCase()}]</b><br>${t}`;
        document.getElementById("log").appendChild(d);
        document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight;
    }  

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    
    window.onload = () => {
        setAgent('mira');
        if (!localStorage.getItem("groq_key")) {
            const novaChave = prompt("‚ö†Ô∏è ACESSO NEGADO: Insira sua GROQ API KEY para inicializar o Kernel AXIOM:");
            if (novaChave) {
                localStorage.setItem("groq_key", novaChave);
                addLog("sys", "Credenciais aceitas. Kernel v3.7 pronto.");
            } else {
                addLog("sys", "ERRO: Sistema operando em modo offline.", "danger");
            }
        }
    };
</script>  
</body>  
</html>
